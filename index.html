<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“3è™Ÿ</title>
    <style>
        /* å­—é«”æ£§è¨­ç½®ï¼šå„ªå…ˆä½¿ç”¨åœ“é«” */
        body {
            font-family: "Yuanti SC", "YouYuan", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* æ¨™é¡Œå€åŸŸ - å³ä¸Šè§’å›ºå®š */
        #header-title {
            position: fixed;
            top: 10px;
            right: 15px;
            text-align: right;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        h1 {
            font-size: 18px;
            margin: 0;
            color: #2c3e50;
        }

        .disclaimer {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
            max-width: 300px;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 800px;
            margin: 120px auto 60px; /* Top margin çµ¦ header ç•™ç©ºé–“ */
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        /* å¥å­æ¨£å¼ */
        .sentence-row {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .pinyin {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
            font-family: Arial, sans-serif; /* æ‹¼éŸ³ç”¨ç„¡è¥¯ç·šé«”æ›´æ˜“è®€ */
        }

        .chinese-text {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .play-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            transition: background 0.2s;
            outline: none;
        }

        .play-btn:hover {
            background-color: #45a049;
        }
        
        .play-btn:active {
            transform: scale(0.98);
        }

        .play-btn.playing {
            background-color: #ff9800;
        }

        .play-btn svg {
            margin-right: 5px;
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* åº•éƒ¨ä¿¡æ¯ */
        .footer {
            text-align: right;
            padding: 20px;
            color: #aaa;
            font-size: 12px;
            border-top: 1px solid #eee;
        }

        /* å¯†ç¢¼é®ç½© */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #login-box {
            text-align: center;
            padding: 30px;
            background: #f0f2f5;
            border-radius: 12px;
        }

        input[type="password"] {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            width: 200px;
        }

        button.login-btn {
            padding: 10px 20px;
            font-size: 16px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* é–‹ç™¼è€…æ¨¡å¼æ¨£å¼ */
        #dev-panel {
            display: none; /* é»˜èªéš±è— */
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: #0f0;
            padding: 15px;
            box-sizing: border-box;
            z-index: 2000;
            font-family: monospace;
            border-top: 2px solid #0f0;
        }

        #dev-controls button {
            background: #333;
            color: #fff;
            border: 1px solid #fff;
            padding: 5px 10px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        #dev-controls button.active {
            background: #f00;
            border-color: #f00;
        }

        #dev-status {
            margin-top: 10px;
            font-size: 12px;
        }

        #dev-toggle {
            cursor: pointer;
            text-decoration: underline;
        }

        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 600px) {
            #header-title {
                position: relative;
                top: 0;
                right: 0;
                text-align: left;
                margin-bottom: 20px;
                background: none;
                box-shadow: none;
                padding: 10px 20px;
            }
            .container {
                margin-top: 0;
            }
        }
    </style>
</head>
<body>

    <!-- å¯†ç¢¼ç™»å…¥å±¤ -->
    <div id="login-overlay">
        <div id="login-box">
            <h2 style="margin-top:0;">è«‹è¼¸å…¥å¯†ç¢¼è¨ªå•</h2>
            <input type="password" id="password-input" placeholder="å¯†ç¢¼">
            <br>
            <button class="login-btn" onclick="checkPassword()">é€²å…¥</button>
            <p id="error-msg" style="color:red; display:none; margin-top:10px;">å¯†ç¢¼éŒ¯èª¤</p>
        </div>
    </div>

    <!-- é ‚éƒ¨æ¨™é¡Œèˆ‡ç‰ˆæ¬Š -->
    <div id="header-title">
        <h1>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“3è™Ÿ</h1>
        <div class="disclaimer">
            æœ¬ç¶²é æ‹¼éŸ³å‡ç”±AIç”Ÿæˆï¼Œæ¨™æº–æ³¨éŸ³è«‹åƒè€ƒã€Šæ™®é€šè©±æ°´å¹³æ¸¬è©¦å¯¦æ–½ç¶±è¦ï¼ˆ2021å¹´ç‰ˆï¼‰ã€‹ã€‚<br>
            éŒ„éŸ³åƒ…ä¾›åƒè€ƒã€‚ç¶²é åƒ…ä¾›VTCå†…éƒ¨ä½¿ç”¨ã€‚<br>
            è¨“ç·´å±€æ™®é€šè©±åŸ¹è¨“æ¸¬è©¦ä¸­å¿ƒç‰ˆæ¬Šæ‰€æœ‰ã€‚
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <div class="container" id="content-area">
        <!-- å…§å®¹å°‡ç”± JS ç”Ÿæˆ -->
    </div>

    <div class="footer">
        ç€è¦½æ¬¡æ•¸: <span id="view-count">0</span>
        <br>
        <span id="dev-toggle" onclick="toggleDevMode()">ğŸ”§ é–‹ç™¼è€…æ¨¡å¼ (æ ¡æº–éŒ„éŸ³)</span>
    </div>

    <!-- é–‹ç™¼è€…æ¨¡å¼é¢æ¿ -->
    <div id="dev-panel">
        <div style="margin-bottom:10px; font-weight:bold;">é–‹ç™¼è€…éŒ„éŸ³æ ¡æº–æ¨¡å¼</div>
        <div id="dev-controls">
            <button id="btn-start-cal" onclick="startCalibration()">1. é–‹å§‹æ ¡æº– (æ’­æ”¾)</button>
            <button id="btn-mark" onclick="markNext()" disabled>2. ä¸‹ä¸€å¥ / æ¨™è¨˜çµæŸ</button>
            <button onclick="exportCode()">3. å°å‡ºä»£ç¢¼</button>
        </div>
        <div id="dev-status">ç­‰å¾…é–‹å§‹... è«‹ç¢ºä¿éŸ³é‡å·²é–‹å•Ÿã€‚</div>
        <div style="font-size:10px; color:#888; margin-top:5px;">æ“ä½œèª¬æ˜ï¼šé»æ“Šã€Œé–‹å§‹ã€å¾ŒéŒ„éŸ³æ’­æ”¾ã€‚æ¯ç•¶ä¸€å¥è©±è®€å®Œï¼Œç«‹å³é»æ“Šã€Œä¸‹ä¸€å¥ã€ã€‚å…¨éƒ¨çµæŸå¾Œé»æ“Šã€Œå°å‡ºã€ã€‚</div>
    </div>

    <!-- éŸ³é »å…ƒç´  -->
    <audio id="main-audio" src="pscleadreading03.mp4" preload="auto"></audio>

<script>
    // ================= é…ç½®æ•¸æ“š =================
    // åˆå§‹æ•¸æ“šï¼šstart å’Œ end ç‚º 0ï¼Œéœ€è¦é€šéé–‹ç™¼è€…æ¨¡å¼æ ¡æº–
    // ä½ å¯ä»¥å°‡æ ¡æº–å¾Œçš„ä»£ç¢¼ç²˜è²¼å›é€™è£¡
    let sentences = [
    {
        "text": "ä½œå“3è™Ÿã€‚",
        "pinyin": "ZuÃ² pÇn sÄn hÃ o.",
        "start": 0,
        "end": 4.32
    },
    {
        "text": "ç‡•å­å»äº†ï¼Œæœ‰å†ä¾†çš„æ™‚å€™ï¼›",
        "pinyin": "YÃ n zi qÃ¹ le, yÇ’u zÃ i lÃ¡i de shÃ­ hou;",
        "start": 4.32,
        "end": 9.633
    },
    {
        "text": "æ¥ŠæŸ³æ¯äº†ï¼Œæœ‰å†é’çš„æ™‚å€™ï¼›",
        "pinyin": "YÃ¡ng liÇ” kÅ« le, yÇ’u zÃ i qÄ«ng de shÃ­ hou;",
        "start": 9.633,
        "end": 14.416
    },
    {
        "text": "æ¡ƒèŠ±è¬äº†ï¼Œæœ‰å†é–‹çš„æ™‚å€™ã€‚",
        "pinyin": "TÃ¡o huÄ xiÃ¨ le, yÇ’u zÃ i kÄi de shÃ­ hou.",
        "start": 14.416,
        "end": 19.067
    },
    {
        "text": "ä½†æ˜¯ï¼Œè°æ˜çš„ï¼Œä½ å‘Šè¨´æˆ‘ï¼Œæˆ‘å€‘çš„æ—¥å­ç‚ºä»€éº¼ä¸€å»ä¸å¾©è¿”å‘¢ï¼Ÿ",
        "pinyin": "DÃ n shÃ¬, cÅng ming de, nÇ gÃ o su wÇ’, wÇ’ men de rÃ¬ zi wÃ¨i shÃ©n me yÃ­ qÃ¹ bÃº fÃ¹ fÇn ne?",
        "start": 19.067,
        "end": 28.663
    },
    {
        "text": "â€”â€”æ˜¯æœ‰äººå·äº†ä»–å€‘ç½·ï¼š",
        "pinyin": "â€”â€” ShÃ¬ yÇ’u rÃ©n tÅu le tÄ men ba:",
        "start": 28.663,
        "end": 32.17
    },
    {
        "text": "é‚£æ˜¯èª°ï¼Ÿ",
        "pinyin": "NÃ  shÃ¬ shuÃ­?",
        "start": 32.17,
        "end": 34.61
    },
    {
        "text": "åˆè—åœ¨ä½•è™•å‘¢ï¼Ÿ",
        "pinyin": "YÃ²u cÃ¡ng zÃ i hÃ© chÃ¹ ne?",
        "start": 34.61,
        "end": 37.397
    },
    {
        "text": "æ˜¯ä»–å€‘è‡ªå·±é€ƒèµ°äº†ç½·ï¼š",
        "pinyin": "ShÃ¬ tÄ men zÃ¬ jÇ tÃ¡o zÇ’u le ba:",
        "start": 37.397,
        "end": 40.955
    },
    {
        "text": "ç¾åœ¨åˆåˆ°äº†å“ªè£å‘¢ï¼Ÿ",
        "pinyin": "XiÃ n zÃ i yÃ²u dÃ o le nÇ lÇ ne?",
        "start": 40.955,
        "end": 44.978
    },
    {
        "text": "å»çš„å„˜ç®¡å»äº†ï¼Œä¾†çš„å„˜ç®¡ä¾†ç€ï¼›",
        "pinyin": "QÃ¹ de jÇn guÇn qÃ¹ le, lÃ¡i de jÇn guÇn lÃ¡i zhe;",
        "start": 44.978,
        "end": 52.72
    },
    {
        "text": "å»ä¾†çš„ä¸­é–“ï¼Œåˆæ€æ¨£åœ°åŒ†åŒ†å‘¢ï¼Ÿ",
        "pinyin": "QÃ¹ lÃ¡i de zhÅng jiÄn, yÃ²u zÄ›n yÃ ng de cÅng cÅng ne?",
        "start": 52.72,
        "end": 57.616
    },
    {
        "text": "æ—©ä¸Šæˆ‘èµ·ä¾†çš„æ™‚å€™ï¼Œå°å±‹è£å°„é€²å…©ä¸‰æ–¹æ–œæ–œçš„å¤ªé™½ã€‚",
        "pinyin": "ZÇo shang wÇ’ qÇ lÃ¡i de shÃ­ hou, xiÇo wÅ« lÇ shÃ¨ jÃ¬n liÇng sÄn fÄng xiÃ© xiÃ© de tÃ i yÃ¡ng.",
        "start": 57.616,
        "end": 66.31
    },
    {
        "text": "å¤ªé™½ä»–æœ‰è…³å•Šï¼Œè¼•è¼•æ‚„æ‚„åœ°æŒªç§»äº†ï¼›",
        "pinyin": "TÃ i yÃ¡ng tÄ yÇ’u jiÇo a, qÄ«ng qÄ«ng qiÄo qiÄo de nuÃ³ yÃ­ le;",
        "start": 66.31,
        "end": 72.747
    },
    {
        "text": "æˆ‘ä¹ŸèŒ«èŒ«ç„¶è·Ÿç€æ—‹è½‰ã€‚",
        "pinyin": "WÇ’ yÄ› mÃ¡ng mÃ¡ng rÃ¡n gÄ“n zhe xuÃ¡n zhuÇn.",
        "start": 72.747,
        "end": 76.904
    },
    {
        "text": "æ–¼æ˜¯â€”â€”æ´—æ‰‹çš„æ™‚å€™ï¼Œæ—¥å­å¾æ°´ç›†è£éå»ï¼›",
        "pinyin": "YÃº shÃ¬ â€”â€” xÇ shÇ’u de shÃ­ hou, rÃ¬ zi cÃ³ng shuÇ pÃ©n lÇ guÃ² qÃ¹;",
        "start": 76.904,
        "end": 84.04
    },
    {
        "text": "åƒé£¯çš„æ™‚å€™ï¼Œæ—¥å­å¾é£¯ç¢—è£éå»ï¼›",
        "pinyin": "ChÄ« fÃ n de shÃ­ hou, rÃ¬ zi cÃ³ng fÃ n wÇn lÇ guÃ² qÃ¹;",
        "start": 84.04,
        "end": 90.151
    },
    {
        "text": "é»˜é»˜æ™‚ï¼Œä¾¿å¾å‡ç„¶çš„é›™çœ¼å‰éå»ã€‚",
        "pinyin": "MÃ² mÃ² shÃ­, biÃ n cÃ³ng nÃ­ng rÃ¡n de shuÄng yÇn qiÃ¡n guÃ² qÃ¹.",
        "start": 90.151,
        "end": 96.111
    },
    {
        "text": "æˆ‘è¦ºå¯Ÿä»–å»çš„åŒ†åŒ†äº†ï¼Œä¼¸å‡ºæ‰‹é®æŒ½æ™‚ï¼Œä»–åˆå¾é®æŒ½ç€çš„æ‰‹é‚Šéå»ï¼›",
        "pinyin": "WÇ’ juÃ© chÃ¡ tÄ qÃ¹ de cÅng cÅng le, shÄ“n chÅ« shÇ’u zhÄ“ wÇn shÃ­, tÄ yÃ²u cÃ³ng zhÄ“ wÇn zhe de shÇ’u biÄn guÃ² qÃ¹;",
        "start": 96.111,
        "end": 108.35
    },
    {
        "text": "å¤©é»‘æ™‚ï¼Œæˆ‘èººåœ¨åºŠä¸Šï¼Œä»–ä¾¿ä¼¶ä¼¶ä¿ä¿åœ°å¾æˆ‘èº«ä¸Šè·¨éï¼Œå¾æˆ‘è…³é‚Šé£›å»äº†ã€‚",
        "pinyin": "TiÄn hÄ“i shÃ­, wÇ’ tÇng zÃ i chuÃ¡ng shang, tÄ biÃ n lÃ­ng lÃ­ng lÃ¬ lÃ¬ de cÃ³ng wÇ’ shÄ“n shang kuÃ  guÃ², cÃ³ng wÇ’ jiÇo biÄn fÄ“i qÃ¹ le.",
        "start": 108.35,
        "end": 122.006
    },
    {
        "text": "ç­‰æˆ‘çœé–‹çœ¼å’Œå¤ªé™½å†è¦‹ï¼Œé€™ç®—åˆæºœèµ°äº†ä¸€æ—¥ã€‚",
        "pinyin": "DÄ›ng wÇ’ zhÄ“ng kÄi yÇn hÃ© tÃ i yÃ¡ng zÃ i jiÃ n, zhÃ¨ suÃ n yÃ²u liÅ« zÇ’u le yÃ­ rÃ¬.",
        "start": 122.006,
        "end": 130.435
    },
    {
        "text": "æˆ‘æ©ç€é¢å˜†æ¯ï¼Œä½†æ˜¯æ–°ä¾†çš„æ—¥å­çš„å½±å…’åˆé–‹å§‹åœ¨å˜†æ¯è£é–ƒéäº†ã€‚",
        "pinyin": "WÇ’ yÇn zhe miÃ n tÃ n xÄ«, dÃ n shÃ¬ xÄ«n lÃ¡i de rÃ¬ zi de yÇng er yÃ²u kÄi shÇ zÃ i tÃ n xÄ« lÇ shÇn guÃ² le.",
        "start": 130.435,
        "end": 141.342
    },
    {
        "text": "åœ¨é€ƒå»å¦‚é£›çš„æ—¥å­è£ï¼Œåœ¨åƒé–€è¬æˆ¶çš„ä¸–ç•Œè£çš„æˆ‘èƒ½åšäº›ä»€éº¼å‘¢ï¼Ÿ",
        "pinyin": "ZÃ i tÃ¡o qÃ¹ rÃº fÄ“i de rÃ¬ zi lÇ, zÃ i qiÄn mÃ©n wÃ n hÃ¹ de shÃ¬ jiÃ¨ lÇ de wÇ’ nÃ©ng zuÃ² xiÄ“ shÃ©n me ne?",
        "start": 141.342,
        "end": 151.407
    },
    {
        "text": "è¡¹æœ‰å¾˜å¾Šç½·äº†ï¼Œè¡¹æœ‰åŒ†åŒ†ç½·äº†ï¼›",
        "pinyin": "ZhÇ yÇ’u pÃ¡i huÃ¡i bÃ  le, zhÇ yÇ’u cÅng cÅng bÃ  le;",
        "start": 151.407,
        "end": 156.754
    },
    {
        "text": "åœ¨å…«åƒå¤šæ—¥çš„åŒ†åŒ†è£ï¼Œé™¤å¾˜å¾Šå¤–ï¼Œåˆå‰©äº›ä»€éº¼å‘¢ï¼Ÿ",
        "pinyin": "ZÃ i bÄ qiÄn duÅ rÃ¬ de cÅng cÅng lÇ, chÃº pÃ¡i huÃ¡i wÃ i, yÃ²u shÃ¨ng xiÄ“ shÃ©n me ne?",
        "start": 156.754,
        "end": 164.769
    },
    {
        "text": "éå»çš„æ—¥å­å¦‚è¼•ç…™ï¼Œè¢«å¾®é¢¨å¹æ•£äº†ï¼Œ",
        "pinyin": "GuÃ² qÃ¹ de rÃ¬ zi rÃº qÄ«ng yÄn, bÃ¨i wÄ“i fÄ“ng chuÄ« sÃ n le,",
        "start": 164.769,
        "end": 172.392
    },
    {
        "text": "å¦‚è–„éœ§ï¼Œè¢«åˆé™½è’¸èäº†ï¼›",
        "pinyin": "RÃº bÃ³ wÃ¹, bÃ¨i chÅ« yÃ¡ng zhÄ“ng rÃ³ng le;",
        "start": 172.392,
        "end": 177.236
    },
    {
        "text": "æˆ‘ç•™ç€äº›ä»€éº¼ç—•è·¡å‘¢ï¼Ÿ",
        "pinyin": "WÇ’ liÃº zhe xiÄ“ shÃ©n me hÃ©n jÃ¬ ne?",
        "start": 177.236,
        "end": 181.174
    },
    {
        "text": "æˆ‘ä½•æ›¾ç•™ç€åƒæ¸¸çµ²æ¨£çš„ç—•è·¡å‘¢ï¼Ÿ",
        "pinyin": "WÇ’ hÃ© cÃ©ng liÃº zhe xiÃ ng yÃ³u sÄ« yÃ ng de hÃ©n jÃ¬ ne?",
        "start": 181.174,
        "end": 186.299
    },
    {
        "text": "æˆ‘èµ¤è£¸è£¸ä¾†åˆ°é€™ä¸–ç•Œï¼Œè½‰çœ¼é–“ä¹Ÿå°‡èµ¤è£¸è£¸çš„å›å»ç½·ï¼Ÿ",
        "pinyin": "WÇ’ chÃ¬ luÇ’ luÇ’ lÃ¡i dÃ o zhÃ¨ shÃ¬ jiÃ¨, zhuÇn yÇn jiÄn yÄ› jiÄng chÃ¬ luÇ’ luÇ’ de huÃ­ qÃ¹ ba?",
        "start": 186.299,
        "end": 194.394
    },
    {
        "text": "ä½†ä¸èƒ½å¹³çš„ï¼Œç‚ºä»€éº¼åç™½ç™½èµ°é€™ä¸€é­å•Šï¼Ÿ",
        "pinyin": "DÃ n bÃ¹ nÃ©ng pÃ­ng de, wÃ¨i shÃ©n me piÄn bÃ¡i bÃ¡i zÇ’u zhÃ¨ yÃ¬ zÄo a?",
        "start": 194.394,
        "end": 201.592
    },
    {
        "text": "ä½ è°æ˜çš„ï¼Œå‘Šè¨´æˆ‘ï¼Œæˆ‘å€‘çš„æ—¥å­ç‚ºä»€éº¼ä¸€å»ä¸å¾©è¿”å‘¢ï¼Ÿ",
        "pinyin": "NÇ cÅng ming de, gÃ o su wÇ’, wÇ’ men de rÃ¬ zi wÃ¨i shÃ©n me yÃ­ qÃ¹ bÃº fÃ¹ fÇn ne?",
        "start": 201.592,
        "end": 210.502
    }
];

    const audio = document.getElementById('main-audio');
    let currentPlayingIndex = -1;
    let playInterval = null;

    // ================= åˆå§‹åŒ– =================
    
    function init() {
        renderSentences();
        updateViewCount();
        
        // å˜—è©¦å¾ LocalStorage è®€å–å·²æ ¡æº–çš„æ•¸æ“šï¼ˆæ–¹ä¾¿é–‹ç™¼è€…èª¿è©¦ä¸ä¸Ÿå¤±æ•¸æ“šï¼‰
        const savedData = localStorage.getItem('vtc_psc_data');
        if (savedData) {
            console.log("ç™¼ç¾å·²ä¿å­˜çš„æ ¡æº–æ•¸æ“šï¼Œå·²åŠ è¼‰ã€‚");
            sentences = JSON.parse(savedData);
        }
    }

    // æ¸²æŸ“åˆ—è¡¨
    function renderSentences() {
        const container = document.getElementById('content-area');
        container.innerHTML = '';
        
        sentences.forEach((item, index) => {
            const row = document.createElement('div');
            row.className = 'sentence-row';
            row.id = `sent-${index}`;
            
            row.innerHTML = `
                <div class="pinyin">${item.pinyin}</div>
                <div class="chinese-text">${item.text}</div>
                <button class="play-btn" onclick="playSentence(${index})">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    æ’­æ”¾éŒ„éŸ³
                </button>
            `;
            container.appendChild(row);
        });
    }

    // ================= æ’­æ”¾é‚è¼¯ =================

    function playSentence(index) {
        if (!audio.duration) {
            alert("éŒ„éŸ³æ–‡ä»¶å°šæœªåŠ è¼‰ï¼Œè«‹ç¨å€™æˆ–æª¢æŸ¥æ–‡ä»¶åæ˜¯å¦ç‚º pscleadreading03.mp4");
            return;
        }

        const sentence = sentences[index];
        
        // å¦‚æœæœªæ ¡æº–ï¼ˆæ™‚é•·ç‚º0ï¼‰
        if (sentence.end <= sentence.start) {
            alert("è©²å¥å­å°šæœªæ ¡æº–æ™‚é–“ã€‚è«‹ä½¿ç”¨é–‹ç™¼è€…æ¨¡å¼é€²è¡Œæ ¡æº–ï¼Œæˆ–ç›´æ¥æ’­æ”¾å…¨æ®µã€‚");
            return;
        }

        // åœæ­¢ä¹‹å‰çš„æ’­æ”¾
        stopPlayback();

        // è¨­ç½® UI ç‹€æ…‹
        currentPlayingIndex = index;
        updatePlayButtonState(index, true);

        // æ’­æ”¾æ§åˆ¶
        audio.currentTime = sentence.start;
        audio.play();

        // ç²¾ç¢ºæª¢æŸ¥åœæ­¢æ™‚é–“
        playInterval = setInterval(() => {
            if (audio.currentTime >= sentence.end) {
                stopPlayback();
            }
        }, 50); // 50ms æª¢æŸ¥ä¸€æ¬¡
    }

    function stopPlayback() {
        audio.pause();
        clearInterval(playInterval);
        if (currentPlayingIndex !== -1) {
            updatePlayButtonState(currentPlayingIndex, false);
            currentPlayingIndex = -1;
        }
    }

    function updatePlayButtonState(index, isPlaying) {
        const btn = document.querySelector(`#sent-${index} .play-btn`);
        if (btn) {
            if (isPlaying) {
                btn.classList.add('playing');
                btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg> æ’­æ”¾ä¸­...';
            } else {
                btn.classList.remove('playing');
                btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> æ’­æ”¾éŒ„éŸ³';
            }
        }
    }

    // ================= è¼”åŠ©åŠŸèƒ½ =================

    function checkPassword() {
        const pwd = document.getElementById('password-input').value;
        if (pwd === 'vtcpsc') {
            document.getElementById('login-overlay').style.display = 'none';
            // ç”¨æˆ¶äº¤äº’è§£é–éŸ³é »ä¸Šä¸‹æ–‡ (iOSå¿…é ˆ)
            audio.load();
        } else {
            document.getElementById('error-msg').style.display = 'block';
        }
    }

    function updateViewCount() {
        let views = localStorage.getItem('vtc_psc_views') || 1024; // åˆå§‹çµ¦å€‹éš¨æ©ŸåŸºæ•¸å¥½çœ‹é»
        views = parseInt(views) + 1;
        localStorage.setItem('vtc_psc_views', views);
        document.getElementById('view-count').innerText = views;
    }

    // ================= é–‹ç™¼è€…æ¨¡å¼ (æ ¡æº–å·¥å…·) =================

    let calIndex = 0;
    
    function toggleDevMode() {
        const panel = document.getElementById('dev-panel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }

    function startCalibration() {
        calIndex = 0;
        audio.currentTime = 0;
        audio.play();
        
        document.getElementById('btn-start-cal').disabled = true;
        document.getElementById('btn-mark').disabled = false;
        document.getElementById('btn-mark').innerText = `æ¨™è¨˜ç¬¬ 1 å¥çµæŸ`;
        
        sentences[0].start = 0; // ç¬¬ä¸€å¥å¾0é–‹å§‹
        updateDevStatus(`æ­£åœ¨æ’­æ”¾ç¬¬ 1 å¥: ${sentences[0].text.substring(0, 10)}...`);
        
        // é«˜äº®ç•¶å‰è¡Œ
        document.getElementById(`sent-0`).scrollIntoView({behavior: "smooth", block: "center"});
        document.getElementById(`sent-0`).style.background = "#eef";
    }

    function markNext() {
        const now = audio.currentTime;
        
        // è¨˜éŒ„ä¸Šä¸€å¥çš„çµæŸæ™‚é–“
        sentences[calIndex].end = now;
        // æ¸…é™¤ä¸Šä¸€å¥é«˜äº®
        document.getElementById(`sent-${calIndex}`).style.background = "transparent";

        calIndex++;

        if (calIndex < sentences.length) {
            // è¨˜éŒ„ä¸‹ä¸€å¥çš„é–‹å§‹æ™‚é–“ (ç·Šæ¥ä¸Šä¸€å¥)
            sentences[calIndex].start = now;
            
            // UI æ›´æ–°
            document.getElementById('btn-mark').innerText = `æ¨™è¨˜ç¬¬ ${calIndex + 1} å¥çµæŸ`;
            updateDevStatus(`æ­£åœ¨æ’­æ”¾ç¬¬ ${calIndex + 1} å¥: ${sentences[calIndex].text.substring(0, 10)}...`);
            
            // é«˜äº®ä¸¦æ»¾å‹•
            const nextRow = document.getElementById(`sent-${calIndex}`);
            nextRow.scrollIntoView({behavior: "smooth", block: "center"});
            nextRow.style.background = "#eef";
        } else {
            // å…¨éƒ¨çµæŸ
            audio.pause();
            document.getElementById('btn-mark').disabled = true;
            document.getElementById('btn-mark').innerText = "æ ¡æº–å®Œæˆ";
            updateDevStatus("æ ¡æº–å·²å®Œæˆï¼è«‹é»æ“Šå°å‡ºä»£ç¢¼ã€‚");
            alert("æ ¡æº–å®Œæˆï¼è«‹é»æ“Šã€Œå°å‡ºä»£ç¢¼ã€æŒ‰éˆ•ï¼Œä¸¦è¤‡è£½ä»£ç¢¼æ›´æ–°æ–‡ä»¶ã€‚");
        }
    }

    function updateDevStatus(msg) {
        document.getElementById('dev-status').innerText = msg;
    }

    function exportCode() {
        // ç‚ºäº†ç²¾åº¦ï¼Œä¿ç•™å°æ•¸é»å¾Œ3ä½
        const cleanData = sentences.map(s => ({
            text: s.text,
            pinyin: s.pinyin,
            start: parseFloat(s.start.toFixed(3)),
            end: parseFloat(s.end.toFixed(3))
        }));

        const jsonStr = JSON.stringify(cleanData, null, 4);
        const codeBlock = `// æ›¿æ›åŸæ–‡ä»¶ä¸­çš„ sentences æ•¸çµ„:\nlet sentences = ${jsonStr};`;
        
        console.log(codeBlock);
        
        // ç°¡å–®çš„å½ˆå‡ºè¤‡è£½çª—å£
        const win = window.open("", "CodeExport", "width=600,height=400");
        win.document.write("<pre>" + codeBlock + "</pre>");
        win.document.title = "è¤‡è£½æ­¤ä»£ç¢¼";
    }

    // å•Ÿå‹•
    init();

</script>
</body>
</html>
