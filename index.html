<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“3è™Ÿ</title>
    <style>
        :root {
            --theme-color: #4A90E2;
            --bg-color: #f5f7fa;
            --text-color: #333;
            --pinyin-font: 'Calibri', sans-serif;
            --main-font: 'Yuanti SC', 'YouYuan', 'Microsoft YaHei', 'SimHei', sans-serif;
            --star-inactive: #d1d1d1;
            --star-active: #f1c40f;
            --highlight-bg: #fff9c4;
        }

        body {
            font-family: var(--main-font);
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
        }

        /* Top Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 100;
            text-align: right;
        }

        .page-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }

        .disclaimer {
            font-size: 0.75rem;
            color: #888;
            margin-top: 4px;
            line-height: 1.2;
        }

        /* Main Container */
        .container {
            max-width: 800px;
            margin: 100px auto 120px; /* Top margin for header, Bottom for tracker */
            padding: 20px;
        }

        /* Login Screen */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .login-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 300px;
            text-align: center;
        }

        .login-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--theme-color);
        }

        .input-group {
            margin-bottom: 15px;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: var(--main-font);
            box-sizing: border-box;
            font-size: 1rem;
        }

        .btn-enter {
            background: var(--theme-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            font-family: var(--main-font);
        }

        .error-msg {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 10px;
            min-height: 1.2em;
        }

        /* Content List */
        .sentence-item {
            background: white;
            margin-bottom: 15px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            transition: background-color 0.3s;
        }

        .sentence-item.played {
            background-color: var(--highlight-bg);
        }

        .pinyin {
            font-family: var(--pinyin-font);
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .chinese-text {
            font-size: 1.4rem;
            font-weight: 500;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .controls {
            display: flex;
            align-items: center;
        }

        .play-btn {
            background: var(--theme-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 2px 5px rgba(74, 144, 226, 0.3);
        }

        .play-btn.playing {
            background: #e74c3c;
        }

        /* Reward Tracker (Bottom) */
        .tracker-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 90;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: auto;
        }

        .tracker-track {
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 5px;
        }

        .star {
            font-size: 1.2rem;
            color: var(--star-inactive);
            transition: all 0.5s;
        }

        .star.active {
            color: var(--star-active);
            text-shadow: 0 0 5px rgba(241, 196, 15, 0.5);
            transform: scale(1.1);
        }

        .trophy {
            font-size: 1.8rem;
            color: var(--star-inactive);
            margin-left: 10px;
            transition: all 0.8s;
        }

        .trophy.active {
            color: #f39c12;
            filter: drop-shadow(0 0 8px #f39c12);
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        /* Completion Area */
        .completion-area {
            text-align: center;
            margin-top: 40px;
            display: none; /* Hidden by default */
        }

        .btn-finish {
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(243, 156, 18, 0.3);
            font-family: var(--main-font);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .btn-finish:active {
            transform: scale(0.95);
        }

        .home-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
            text-decoration: none;
            font-size: 0.9rem;
            margin-top: 10px;
            cursor: pointer;
        }

        .home-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            max-width: 350px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal h3 { color: var(--theme-color); margin-top: 0; }
        .modal-close {
            margin-top: 20px;
            padding: 8px 25px;
            background: #ddd;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-family: var(--main-font);
        }

        /* Developer Mode */
        #dev-toggle {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 200;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.3;
            filter: grayscale(100%);
            display: none; /* Controlled by JS */
        }
        
        #dev-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 250px;
            background: rgba(0,0,0,0.9);
            color: #0f0;
            z-index: 3000;
            padding: 20px;
            box-sizing: border-box;
            font-family: monospace;
            display: none;
            overflow-y: auto;
        }

        .dev-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .dev-btn {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 5px 10px;
            cursor: pointer;
        }

        .active-sentence-highlight {
            border: 2px solid #e74c3c;
        }

    </style>
</head>
<body>

    <!-- Audio Element -->
    <audio id="main-audio" preload="auto">
        <source src="pscleadreading03.mp4" type="audio/mp4">
        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒéŸ³é »æ’­æ”¾ã€‚
    </audio>

    <!-- Dev Toggle -->
    <div id="dev-toggle" title="é–‹ç™¼è€…æ¨¡å¼">ğŸ› ï¸</div>

    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-box">
            <h2 class="login-title">é–‹å§‹ç·´ç¿’</h2>
            <div class="input-group">
                <input type="text" id="username" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—">
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
            </div>
            <div class="error-msg" id="login-error"></div>
            <button class="btn-enter" id="btn-login">é€²å…¥</button>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="page-title">æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“3è™Ÿ</div>
        <div class="disclaimer">æœ¬ç¶²é æ‹¼éŸ³å‡ç”±AIç”Ÿæˆï¼Œæ¨™æº–æ³¨éŸ³è«‹åƒè€ƒã€Šæ™®é€šè©±æ°´å¹³æ¸¬è©¦å¯¦æ–½ç¶±è¦ï¼ˆ2021å¹´ç‰ˆï¼‰ã€‹ã€‚éŒ„éŸ³åƒ…ä¾›åƒè€ƒã€‚ç¶²é åƒ…ä¾›VTCå†…éƒ¨ä½¿ç”¨ã€‚è·æ¥­è¨“ç·´å±€æ™®é€šè©±åŸ¹è¨“æ¸¬è©¦ä¸­å¿ƒç‰ˆæ¬Šæ‰€æœ‰ã€‚</div>
    </div>

    <!-- Main Content -->
    <div class="container" id="content-container">
        <!-- Sentences will be injected here by JS -->
        
        <div class="completion-area" id="completion-area">
            <button class="btn-finish" id="btn-finish">æˆ‘å·²å®Œæˆè·Ÿè®€ç·´ç¿’å•¦ï¼</button>
            <a href="https://echo02-game.github.io/pscleadreading-hub/" class="home-link">
                <span class="home-icon">ğŸ“–</span>
                <span>å›ä¸»ç›®éŒ„</span>
            </a>
        </div>
    </div>

    <!-- Reward Tracker -->
    <div class="tracker-container">
        <div class="tracker-track" id="tracker-track">
            <!-- Stars will be injected here -->
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="success-modal">
        <div class="modal">
            <h3>å¤ªæ£’å•¦ï¼</h3>
            <p>æ‰“å¡ä¿¡æ¯å·²è¤‡è£½ï¼Œå¿«å»åˆ†äº«åŠªåŠ›å¾Œçš„å–œæ‚…å§ï¼</p>
            <button class="modal-close" onclick="document.getElementById('success-modal').style.display='none'">é—œé–‰</button>
        </div>
    </div>

    <!-- Dev Panel -->
    <div id="dev-panel">
        <div class="dev-controls">
            <button class="dev-btn" id="start-rec">é–‹å§‹éŒ„è£½æ¨¡å¼</button>
            <button class="dev-btn" id="mark-next">æ¨™è¨˜ä¸‹ä¸€å¥ (Space)</button>
            <button class="dev-btn" id="export-json">è¤‡è£½ JSON</button>
            <span>ç•¶å‰: <span id="dev-current-idx">-1</span></span>
        </div>
        <div id="dev-log"></div>
    </div>

    <script>
        // --- Configuration ---
        const PASSWORD = "vtcpsc";
        // æ³¨æ„ï¼šé€™è£¡çš„ start å’Œ end æ˜¯æ™‚é–“ï¼ˆç§’ï¼‰ã€‚
        // ç”±æ–¼æˆ‘æ²’æœ‰å¯¦éš›çš„éŸ³é »æ™‚é–“è»¸ï¼Œé€™è£¡çš„æ•¸æ“šå…¨éƒ¨è¨­ç½®ç‚º 0 æˆ–ä¼°ç®—å€¼ã€‚
        // è«‹ä½¿ç”¨ã€Œé–‹ç™¼è€…æ¨¡å¼ã€è‡ªè¡ŒéŒ„è£½ç”Ÿæˆæº–ç¢ºçš„ JSON ä¸¦æ›¿æ›æ­¤è™•ã€‚
        let sentenceData = [
    {
        "text": "ç‡•å­å»äº†ï¼Œæœ‰å†ä¾†çš„æ™‚å€™ï¼›",
        "pinyin": "YÃ nzi qÃ¹le, yÇ’u zÃ ilÃ¡i de shÃ­hÃ²u;",
        "start": 0,
        "end": 9.35
    },
    {
        "text": "æ¥ŠæŸ³æ¯äº†ï¼Œæœ‰å†é’çš„æ™‚å€™ï¼›",
        "pinyin": "YÃ¡ngliÇ” kÅ«le, yÇ’u zÃ i qÄ«ng de shÃ­hÃ²u;",
        "start": 9.35,
        "end": 14.16
    },
    {
        "text": "æ¡ƒèŠ±è¬äº†ï¼Œæœ‰å†é–‹çš„æ™‚å€™ã€‚",
        "pinyin": "TÃ¡ohuÄ xiÃ¨le, yÇ’u zÃ i kÄi de shÃ­hÃ²u.",
        "start": 14.16,
        "end": 18.78
    },
    {
        "text": "ä½†æ˜¯ï¼Œè°æ˜çš„ï¼Œä½ å‘Šè¨´æˆ‘ï¼Œæˆ‘å€‘çš„æ—¥å­ç‚ºä»€éº¼ä¸€å»ä¸å¾©è¿”å‘¢ï¼Ÿ",
        "pinyin": "DÃ nshÃ¬, cÅngmÃ­ng de, nÇ gÃ osÃ¹ wÇ’, wÇ’men de rÃ¬zi wÃ¨ishÃ©me yÄ«qÃ¹bÃ¹fÃ¹fÇn ne?",
        "start": 18.78,
        "end": 28.43
    },
    {
        "text": "â€”â€”æ˜¯æœ‰äººå·äº†ä»–å€‘ç½·ï¼šé‚£æ˜¯èª°ï¼Ÿ",
        "pinyin": "â€”â€”ShÃ¬ yÇ’urÃ©n tÅule tÄmen ba: nÃ  shÃ¬ shÃ©i?",
        "start": 28.43,
        "end": 34.08
    },
    {
        "text": "åˆè—åœ¨ä½•è™•å‘¢ï¼Ÿ",
        "pinyin": "YÃ²u cÃ¡ng zÃ i hÃ©chÃ¹ ne?",
        "start": 34.08,
        "end": 37.13
    },
    {
        "text": "æ˜¯ä»–å€‘è‡ªå·±é€ƒèµ°äº†ç½·ï¼šç¾åœ¨åˆåˆ°äº†å“ªè£å‘¢ï¼Ÿ",
        "pinyin": "ShÃ¬ tÄmen zÃ¬jÇ tÃ¡ozÇ’ule ba: xiÃ nzÃ i yÃ²u dÃ ole nÇlÇ ne?",
        "start": 37.13,
        "end": 44.65
    },
    {
        "text": "å»çš„å„˜ç®¡å»äº†ï¼Œä¾†çš„å„˜ç®¡ä¾†ç€ï¼›",
        "pinyin": "QÃ¹ de jÇnguÇn qÃ¹le, lÃ¡i de jÇnguÇn lÃ¡izhe;",
        "start": 44.65,
        "end": 52.51
    },
    {
        "text": "å»ä¾†çš„ä¸­é–“ï¼Œåˆæ€æ¨£åœ°åŒ†åŒ†å‘¢ï¼Ÿ",
        "pinyin": "QÃ¹ lÃ¡i de zhÅngjiÄn, yÃ²u zÄ›nyÃ ng de cÅngcÅng ne?",
        "start": 52.51,
        "end": 57.49
    },
    {
        "text": "æ—©ä¸Šæˆ‘èµ·ä¾†çš„æ™‚å€™ï¼Œå°å±‹è£å°„é€²å…©ä¸‰æ–¹æ–œæ–œçš„å¤ªé™½ã€‚",
        "pinyin": "ZÇoshang wÇ’ qÇlÃ¡i de shÃ­hÃ²u, xiÇowÅ« lÇ shÃ¨ jÃ¬n liÇng sÄn fÄng xiÃ©xiÃ© de tÃ iyÃ¡ng.",
        "start": 57.49,
        "end": 66.1
    },
    {
        "text": "å¤ªé™½ä»–æœ‰è…³å•Šï¼Œè¼•è¼•æ‚„æ‚„åœ°æŒªç§»äº†ï¼›",
        "pinyin": "TÃ iyÃ¡ng tÄ yÇ’u jiÇo a, qÄ«ngqÄ«ng qiÄoqiÄo de nuÃ³yÃ­le;",
        "start": 66.1,
        "end": 72.53
    },
    {
        "text": "æˆ‘ä¹ŸèŒ«èŒ«ç„¶è·Ÿç€æ—‹è½‰ã€‚",
        "pinyin": "WÇ’ yÄ› mÃ¡ngmÃ¡ngrÃ¡n gÄ“nzhe xuÃ¡nzhuÇn.",
        "start": 72.53,
        "end": 76.44
    },
    {
        "text": "æ–¼æ˜¯â€”â€”æ´—æ‰‹çš„æ™‚å€™ï¼Œæ—¥å­å¾æ°´ç›†è£éå»ï¼›",
        "pinyin": "YÃºshÃ¬â€”â€”xÇshÇ’u de shÃ­hÃ²u, rÃ¬zi cÃ³ng shuÇpÃ©n lÇ guÃ²qÃ¹;",
        "start": 76.44,
        "end": 83.85
    },
    {
        "text": "åƒé£¯çš„æ™‚å€™ï¼Œæ—¥å­å¾é£¯ç¢—è£éå»ï¼›",
        "pinyin": "ChÄ«fÃ n de shÃ­hÃ²u, rÃ¬zi cÃ³ng fÃ nwÇn lÇ guÃ²qÃ¹;",
        "start": 83.85,
        "end": 89.75
    },
    {
        "text": "é»˜é»˜æ™‚ï¼Œä¾¿å¾å‡ç„¶çš„é›™çœ¼å‰éå»ã€‚",
        "pinyin": "MÃ²mÃ² shÃ­, biÃ n cÃ³ng nÃ­ngrÃ¡n de shuÄngyÇn qiÃ¡n guÃ²qÃ¹.",
        "start": 89.75,
        "end": 95.95
    },
    {
        "text": "æˆ‘è¦ºå¯Ÿä»–å»çš„åŒ†åŒ†äº†ï¼Œä¼¸å‡ºæ‰‹é®æŒ½æ™‚ï¼Œä»–åˆå¾é®æŒ½ç€çš„æ‰‹é‚Šéå»ï¼›",
        "pinyin": "WÇ’ juÃ©chÃ¡ tÄ qÃ¹ de cÅngcÅngle, shÄ“nchÅ«shÇ’u zhÄ“wÇn shÃ­, tÄ yÃ²u cÃ³ng zhÄ“wÇn zhe de shÇ’ubiÄn guÃ²qÃ¹;",
        "start": 95.95,
        "end": 108.03
    },
    {
        "text": "å¤©é»‘æ™‚ï¼Œæˆ‘èººåœ¨åºŠä¸Šï¼Œä»–ä¾¿ä¼¶ä¼¶ä¿ä¿åœ°å¾æˆ‘èº«ä¸Šè·¨éï¼Œå¾æˆ‘è…³é‚Šé£›å»äº†ã€‚",
        "pinyin": "TiÄnhÄ“i shÃ­, wÇ’ tÇng zÃ i chuÃ¡ngshÃ ng, tÄ biÃ n lÃ­nglÃ­nglÃ¬lÃ¬ de cÃ³ng wÇ’ shÄ“nshang kuÃ guÃ², cÃ³ng wÇ’ jiÇobiÄn fÄ“iqÃ¹le.",
        "start": 108.03,
        "end": 121.79
    },
    {
        "text": "ç­‰æˆ‘çœé–‹çœ¼å’Œå¤ªé™½å†è¦‹ï¼Œé€™ç®—åˆæºœèµ°äº†ä¸€æ—¥ã€‚",
        "pinyin": "DÄ›ng wÇ’ zhÄ“ngkÄiyÇn hÃ© tÃ iyÃ¡ng zÃ ijiÃ n, zhÃ¨ suÃ n yÃ²u liÅ«zÇ’ule yÄ«rÃ¬.",
        "start": 121.79,
        "end": 130.16
    },
    {
        "text": "æˆ‘æ©ç€é¢å˜†æ¯ï¼Œä½†æ˜¯æ–°ä¾†çš„æ—¥å­çš„å½±å…’åˆé–‹å§‹åœ¨å˜†æ¯è£é–ƒéäº†ã€‚",
        "pinyin": "WÇ’ yÇnzhe miÃ n tÃ nxÄ«, dÃ nshÃ¬ xÄ«nlÃ¡i de rÃ¬zi de yÇnger yÃ²u kÄishÇ zÃ i tÃ nxÄ« lÇ shÇnguÃ²le.",
        "start": 130.16,
        "end": 141.01
    },
    {
        "text": "åœ¨é€ƒå»å¦‚é£›çš„æ—¥å­è£ï¼Œåœ¨åƒé–€è¬æˆ¶çš„ä¸–ç•Œè£çš„æˆ‘èƒ½åšäº›ä»€éº¼å‘¢ï¼Ÿ",
        "pinyin": "ZÃ i tÃ¡oqÃ¹ rÃº fÄ“i de rÃ¬zi lÇ, zÃ i qiÄnmÃ©n wÃ nhÃ¹ de shÃ¬jiÃ¨ lÇ de wÇ’ nÃ©ng zuÃ² xiÄ“ shÃ©nme ne?",
        "start": 141.01,
        "end": 150.98
    },
    {
        "text": "è¡¹æœ‰å¾˜å¾Šç½·äº†ï¼Œè¡¹æœ‰åŒ†åŒ†ç½·äº†ï¼›",
        "pinyin": "ZhÇyÇ’u pÃ¡ihuÃ¡i bÃ le, zhÇyÇ’u cÅngcÅng bÃ le;",
        "start": 150.98,
        "end": 156.68
    },
    {
        "text": "åœ¨å…«åƒå¤šæ—¥çš„åŒ†åŒ†è£ï¼Œé™¤å¾˜å¾Šå¤–ï¼Œåˆå‰©äº›ä»€éº¼å‘¢ï¼Ÿ",
        "pinyin": "ZÃ i bÄqiÄn duÅ rÃ¬ de cÅngcÅng lÇ, chÃº pÃ¡ihuÃ¡i wÃ i, yÃ²u shÃ¨ng xiÄ“ shÃ©nme ne?",
        "start": 156.68,
        "end": 164.57
    },
    {
        "text": "éå»çš„æ—¥å­å¦‚è¼•ç…™ï¼Œè¢«å¾®é¢¨å¹æ•£äº†ï¼Œå¦‚è–„éœ§ï¼Œè¢«åˆé™½è’¸èäº†ï¼›",
        "pinyin": "GuÃ²qÃ¹ de rÃ¬zi rÃº qÄ«ngyÄn, bÃ¨i wÄ“ifÄ“ng chuÄ«sÃ nle, rÃº bÃ³wÃ¹, bÃ¨i chÅ«yÃ¡ng zhÄ“ngrÃ³ngle;",
        "start": 164.57,
        "end": 177.02
    },
    {
        "text": "æˆ‘ç•™ç€äº›ä»€éº¼ç—•è·¡å‘¢ï¼Ÿ",
        "pinyin": "WÇ’ liÃºzhe xiÄ“ shÃ©nme hÃ©njÄ« ne?",
        "start": 177.02,
        "end": 181.05
    },
    {
        "text": "æˆ‘ä½•æ›¾ç•™ç€åƒæ¸¸çµ²æ¨£çš„ç—•è·¡å‘¢ï¼Ÿ",
        "pinyin": "WÇ’ hÃ©cÃ©ng liÃºzhe xiÃ ng yÃ³usÄ« yÃ ng de hÃ©njÄ« ne?",
        "start": 181.05,
        "end": 186.17
    },
    {
        "text": "æˆ‘èµ¤è£¸è£¸ä¾†åˆ°é€™ä¸–ç•Œï¼Œè½‰çœ¼é–“ä¹Ÿå°‡èµ¤è£¸è£¸çš„å›å»ç½·ï¼Ÿ",
        "pinyin": "WÇ’ chÃ¬luÇ’luÇ’ lÃ¡idÃ o zhÃ¨ shÃ¬jiÃ¨, zhuÇnyÇn jiÄn yÄ› jiÄng chÃ¬luÇ’luÇ’ de huÃ­qÃ¹ ba?",
        "start": 186.17,
        "end": 194.26
    }
];

        // --- State ---
        let currentAudio = document.getElementById('main-audio');
        let playingIndex = -1;
        let isPaused = false;
        let userName = "";
        let progress = new Array(sentenceData.length).fill(false);
        let checkTimeInterval = null;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initLogin();
            detectWindows();
        });

        function detectWindows() {
            // Check if user is on Windows to show Dev Toggle
            if (navigator.platform.indexOf('Win') > -1 || navigator.userAgent.indexOf('Windows') > -1) {
                document.getElementById('dev-toggle').style.display = 'block';
            }
        }

        // --- Login Logic ---
        function initLogin() {
            const btnLogin = document.getElementById('btn-login');
            const pwdInput = document.getElementById('password');
            const nameInput = document.getElementById('username');

            const attemptLogin = () => {
                const pwd = pwdInput.value;
                const name = nameInput.value.trim();
                
                if (pwd === PASSWORD) {
                    if(name === "") {
                         document.getElementById('login-error').textContent = "è«‹è¼¸å…¥åå­—";
                         return;
                    }
                    userName = name;
                    document.getElementById('login-screen').style.display = 'none';
                    initApp();
                } else {
                    document.getElementById('login-error').textContent = "è«‹è¼¸å…¥æ­£ç¢ºå¯†ç¢¼";
                }
            };

            btnLogin.addEventListener('click', attemptLogin);
            pwdInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') attemptLogin();
            });
        }

        // --- App Logic ---
        function initApp() {
            renderSentences();
            renderTracker();
            setupCompletion();
            setupDevMode(); // Initialize developer mode listeners
        }

        function renderSentences() {
            const container = document.getElementById('content-container');
            const completionArea = document.getElementById('completion-area');
            
            sentenceData.forEach((item, index) => {
                const el = document.createElement('div');
                el.className = 'sentence-item';
                el.id = `sentence-${index}`;
                el.innerHTML = `
                    <div class="pinyin">${item.pinyin}</div>
                    <div class="chinese-text">${item.text}</div>
                    <div class="controls">
                        <button class="play-btn" onclick="togglePlay(${index})">â–¶</button>
                    </div>
                `;
                container.insertBefore(el, completionArea);
            });
        }

        function renderTracker() {
            const track = document.getElementById('tracker-track');
            track.innerHTML = ''; // clear
            
            sentenceData.forEach((_, index) => {
                const star = document.createElement('span');
                star.className = 'star';
                star.innerHTML = 'â˜…'; // Solid star, color controlled by CSS
                star.id = `star-${index}`;
                // Initially hollow appearance via CSS color (gray)
                track.appendChild(star);
            });

            // Add Trophy
            const trophy = document.createElement('span');
            trophy.className = 'trophy';
            trophy.id = 'trophy';
            trophy.innerHTML = 'ğŸ†';
            track.appendChild(trophy);
        }

        // --- Audio Control Logic ---
        window.togglePlay = function(index) {
            // If clicking the same button that is currently active
            if (playingIndex === index) {
                if (currentAudio.paused) {
                    resumeAudio();
                } else {
                    pauseAudio();
                }
            } else {
                // Clicking a new button
                playSentence(index);
            }
        };

        function playSentence(index) {
            // Reset previous button if exists
            if (playingIndex !== -1 && playingIndex !== index) {
                updatePlayButtonUI(playingIndex, false);
            }

            playingIndex = index;
            const data = sentenceData[index];
            
            // If we have accurate data, use it. Otherwise just start.
            currentAudio.currentTime = data.start;
            currentAudio.play();
            updatePlayButtonUI(index, true);

            // Start monitoring time
            if (checkTimeInterval) clearInterval(checkTimeInterval);
            
            checkTimeInterval = setInterval(() => {
                // Stop if we reach the end of the segment
                if (currentAudio.currentTime >= data.end) {
                    currentAudio.pause();
                    clearInterval(checkTimeInterval);
                    onSentenceFinished(index);
                }
            }, 50); // check every 50ms
        }

        function pauseAudio() {
            currentAudio.pause();
            isPaused = true;
            if (playingIndex !== -1) {
                const btn = document.querySelector(`#sentence-${playingIndex} .play-btn`);
                if(btn) btn.innerHTML = 'â–¶'; // Show Play icon
            }
        }

        function resumeAudio() {
            currentAudio.play();
            isPaused = false;
            if (playingIndex !== -1) {
                const btn = document.querySelector(`#sentence-${playingIndex} .play-btn`);
                if(btn) btn.innerHTML = 'âšâš'; // Show Pause icon
            }
        }

        function updatePlayButtonUI(index, isPlaying) {
            const btn = document.querySelector(`#sentence-${index} .play-btn`);
            if (!btn) return;
            
            if (isPlaying) {
                btn.innerHTML = 'âšâš'; // Pause icon
                btn.classList.add('playing');
            } else {
                btn.innerHTML = 'â–¶';
                btn.classList.remove('playing');
            }
        }

        function onSentenceFinished(index) {
            updatePlayButtonUI(index, false);
            playingIndex = -1;
            
            // Mark as played visually
            const item = document.getElementById(`sentence-${index}`);
            item.classList.add('played');

            // Update progress
            if (!progress[index]) {
                progress[index] = true;
                updateTracker(index);
                checkAllCompleted();
            }
        }

        function updateTracker(index) {
            const star = document.getElementById(`star-${index}`);
            if (star) star.classList.add('active');
        }

        function checkAllCompleted() {
            const allDone = progress.every(p => p === true);
            if (allDone) {
                document.getElementById('trophy').classList.add('active');
                document.getElementById('completion-area').style.display = 'block';
                // Scroll to bottom to show button
                setTimeout(() => {
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                }, 500);
            }
        }

        // --- Completion Logic ---
        function setupCompletion() {
            document.getElementById('btn-finish').addEventListener('click', () => {
                const date = new Date();
                const dateStr = `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
                const msg = `${userName}å·²æ–¼${dateStr}å®Œæˆä½œå“3è™Ÿè·Ÿè®€ç·´ç¿’ï¼`;

                // Copy to clipboard
                navigator.clipboard.writeText(msg).then(() => {
                    document.getElementById('success-modal').style.display = 'flex';
                }).catch(err => {
                    // Fallback for some browsers
                    const textArea = document.createElement("textarea");
                    textArea.value = msg;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand("copy");
                    document.body.removeChild(textArea);
                    document.getElementById('success-modal').style.display = 'flex';
                });
            });
        }

        // --- Developer Mode Logic ---
        let devModeActive = false;
        let recordingData = [];
        let recCurrentIndex = 0;

        function setupDevMode() {
            const toggle = document.getElementById('dev-toggle');
            const panel = document.getElementById('dev-panel');
            const startBtn = document.getElementById('start-rec');
            const markBtn = document.getElementById('mark-next');
            const exportBtn = document.getElementById('export-json');
            const logDiv = document.getElementById('dev-log');

            toggle.addEventListener('click', () => {
                devModeActive = !devModeActive;
                panel.style.display = devModeActive ? 'block' : 'none';
                if(devModeActive) {
                    // Force player to fixed position or specialized view if needed
                    // For now, panel overlay is sufficient
                }
            });

            startBtn.addEventListener('click', () => {
                // Initialize recording
                recordingData = JSON.parse(JSON.stringify(sentenceData)); // clone structure
                recCurrentIndex = 0;
                
                // Start Audio
                currentAudio.currentTime = 0;
                currentAudio.play();
                
                // UI update
                highlightDevSentence(0);
                logDiv.innerHTML = "éŒ„è£½ä¸­... è«‹åœ¨æ¯å¥è©±çµæŸæ™‚æŒ‰ã€Œç©ºæ ¼éµã€";
                
                // Set first start time
                recordingData[0].start = 0;
            });

            const markAction = (e) => {
                if (!devModeActive || recCurrentIndex >= recordingData.length) return;
                
                // Prevent scrolling with space
                if (e && e.type === 'keydown' && e.code === 'Space') e.preventDefault(); 

                const now = currentAudio.currentTime;
                
                // End current sentence
                recordingData[recCurrentIndex].end = now;
                logDiv.innerHTML = `å·²æ¨™è¨˜å¥ ${recCurrentIndex + 1}: ${now.toFixed(2)}s`;

                // Start next sentence if exists
                if (recCurrentIndex < recordingData.length - 1) {
                    recCurrentIndex++;
                    recordingData[recCurrentIndex].start = now;
                    highlightDevSentence(recCurrentIndex);
                } else {
                    currentAudio.pause();
                    logDiv.innerHTML += "<br><strong>éŒ„è£½å®Œæˆï¼è«‹é»æ“Šã€Œè¤‡è£½ JSONã€</strong>";
                }
            };

            markBtn.addEventListener('click', markAction);
            document.addEventListener('keydown', (e) => {
                if(devModeActive && e.code === 'Space') {
                    markAction(e);
                }
            });

            exportBtn.addEventListener('click', () => {
                // Round numbers for cleanliness
                const cleanData = recordingData.map(d => ({
                    text: d.text,
                    pinyin: d.pinyin,
                    start: Number(d.start.toFixed(2)),
                    end: Number(d.end.toFixed(2))
                }));
                
                const jsonStr = JSON.stringify(cleanData, null, 4); // Pretty print
                navigator.clipboard.writeText(jsonStr);
                alert("JSON å·²è¤‡è£½ï¼è«‹å›åˆ°ä»£ç¢¼ä¸­æ›¿æ› sentenceData è®Šé‡ã€‚");
            });
        }

        function highlightDevSentence(index) {
            document.querySelectorAll('.sentence-item').forEach(el => el.classList.remove('active-sentence-highlight'));
            const el = document.getElementById(`sentence-${index}`);
            if(el) {
                el.classList.add('active-sentence-highlight');
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                document.getElementById('dev-current-idx').innerText = index + 1;
            }
        }

    </script>
</body>
</html>
